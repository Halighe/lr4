{% extends 'base.html.twig' %}

{% block title %}Регистрация
{% endblock %}

{% block body %}
	<div class="container">
		<div class="row justify-content-center">
			<div class="col-md-8 col-lg-6">
				<div class="card shadow-sm mt-5">
					<div class="card-header bg-white text-center py-4">
						<h1 class="h2 mb-2 font-weight-bold text-primary">
							<i class="fas fa-user-plus me-2"></i>Регистрация
						</h1>
						<p class="text-muted mb-0 small">Создайте новый аккаунт</p>
					</div>

					<div class="card-body p-4 p-md-5">
						{% if form_errors(registrationForm) %}
							<div class="alert alert-danger alert-dismissible fade show" role="alert">
								<i class="fas fa-exclamation-triangle me-2"></i>
								{{ form_errors(registrationForm) }}
								<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
							</div>
						{% endif %}

						{{ form_start(registrationForm, {'attr': {'class': 'needs-validation', 'novalidate': 'novalidate'}}) }}

						<div class="mb-4">
							<label for="{{ registrationForm.email.vars.id }}" class="form-label">
								<i class="fas fa-envelope me-1"></i>Email адрес
							</label>
							<div class="input-group input-group-lg">
								<span class="input-group-text">
									<i class="fas fa-at"></i>
								</span>
								{{ form_widget(registrationForm.email, {
                                'attr': {
                                    'class': 'form-control',
                                    'placeholder': 'Введите ваш email',
                                    'aria-describedby': 'emailHelp'
                                }
                            }) }}
							</div>
							<div class="form-text" id="emailHelp">
								Мы никогда не передадим ваш email третьим лицам
							</div>
							<div class="invalid-feedback">
								Пожалуйста, введите корректный email адрес
							</div>
						</div>

						<div class="mb-4">
							<label for="{{ registrationForm.plainPassword.vars.id }}" class="form-label">
								<i class="fas fa-lock me-1"></i>Пароль
							</label>
							<div class="input-group input-group-lg">
								<span class="input-group-text">
									<i class="fas fa-key"></i>
								</span>
								{{ form_widget(registrationForm.plainPassword, {
                                'attr': {
                                    'class': 'form-control',
                                    'placeholder': 'Создайте надежный пароль'
                                },
                                'label': 'Пароль'
                            }) }}
								<button class="btn btn-outline-secondary" type="button" id="togglePassword">
									<i class="fas fa-eye"></i>
								</button>
							</div>
							<div class="form-text">
								Пароль должен содержать минимум 6 символов
							</div>
							<div class="invalid-feedback">
								Пожалуйста, введите пароль
							</div>
						</div>

						<div class="mb-4">
							<div class="form-check">
								{{ form_widget(registrationForm.agreeTerms, {
                                'attr': {
                                    'class': 'form-check-input'
                                }
                            }) }}
								<label class="form-check-label" for="{{ registrationForm.agreeTerms.vars.id }}">
									Я согласен с
									<a href="#" data-bs-toggle="modal" data-bs-target="#termsModal" class="text-decoration-none">
										условиями использования
									</a>
								</label>
								<div class="invalid-feedback">
									Вы должны согласиться с условиями
								</div>
							</div>
						</div>

						<div class="d-grid gap-2 mb-4">
							<button type="submit" class="btn btn-primary btn-lg">
								<i class="fas fa-user-plus me-2"></i>Зарегистрироваться
							</button>
						</div>

						{{ form_end(registrationForm) }}

						<div class="text-center mt-4 pt-3 border-top">
							<p class="text-muted mb-3">Уже есть аккаунт?</p>
							<a href="{{ path('app_login') }}" class="btn btn-outline-success btn-lg w-100">
								<i class="fas fa-sign-in-alt me-2"></i>Войти в систему
							</a>
						</div>
					</div>

					<div class="card-footer bg-light text-center py-3">
						<small class="text-muted">
							<i class="fas fa-shield-alt me-1"></i>
							Ваши данные защищены и шифруются
						</small>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Модальное окно с условиями использования -->
	<div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="termsModalLabel">
						<i class="fas fa-file-contract me-2"></i>Условия использования
					</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<h6>1. Общие положения</h6>
					<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>

					<h6>2. Использование сервиса</h6>
					<p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>

					<h6>3. Конфиденциальность</h6>
					<p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.</p>

					<h6>4. Ответственность</h6>
					<p>Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-primary" data-bs-dismiss="modal">Понятно</button>
				</div>
			</div>
		</div>
	</div>

	<script>
		// Валидация формы
document.addEventListener('DOMContentLoaded', function () {
'use strict';

// Получаем все формы с классом needs-validation
var forms = document.querySelectorAll('.needs-validation');

// Перебираем формы и добавляем обработчик
Array.prototype.slice.call(forms).forEach(function (form) {
form.addEventListener('submit', function (event) {
if (! form.checkValidity()) {
event.preventDefault();
event.stopPropagation();
}
form.classList.add('was-validated');
}, false);
});

// Переключение видимости пароля
const togglePassword = document.getElementById('togglePassword');
const passwordInput = document.getElementById('{{ registrationForm.plainPassword.vars.id }}');

if (togglePassword && passwordInput) {
togglePassword.addEventListener('click', function () {
const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
passwordInput.setAttribute('type', type);
this.querySelector('i').classList.toggle('fa-eye');
this.querySelector('i').classList.toggle('fa-eye-slash');
});
}

// Автоматическая проверка согласия с условиями
const agreeTerms = document.getElementById('{{ registrationForm.agreeTerms.vars.id }}');
if (agreeTerms) {
agreeTerms.addEventListener('change', function () {
if (this.checked) {
this.classList.remove('is-invalid');
}
});
}
});
	</script>

	<style>
		/* Стили для формы регистрации */
		.card {
			border: none;
			border-radius: 15px;
			overflow: hidden;
		}

		.card-header {
			border-bottom: 2px solid rgba(0, 123, 255, .1);
			border-radius: 15px 15px 0 0 !important;
		}

		.form-control,
		.input-group-text {
			border-radius: 10px;
		}

		.btn-lg {
			border-radius: 10px;
			padding: 0.75rem 1.5rem;
			font-weight: 500;
		}

		/* Анимация для карточки */
		.card {
			transition: all 0.3s ease;
		}

		.card:hover {
			transform: translateY(-5px);
			box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1) !important;
		}

		/* Стили для чекбокса согласия */
		.form-check-input:checked {
			background-color: #0d6efd;
			border-color: #0d6efd;
		}

		/* Стили для модального окна */
		.modal-content {
			border-radius: 15px;
		}

		/* Кастомный скроллбар для модального окна */
		.modal-body {
			max-height: 400px;
			overflow-y: auto;
		}

		.modal-body::-webkit-scrollbar {
			width: 8px;
		}

		.modal-body::-webkit-scrollbar-track {
			background: #f1f1f1;
			border-radius: 4px;
		}

		.modal-body::-webkit-scrollbar-thumb {
			background: #888;
			border-radius: 4px;
		}

		.modal-body::-webkit-scrollbar-thumb:hover {
			background: #555;
		}

		/* Адаптивность */
		@media(max-width: 768px) {
			.container {
				padding: 15px;
			}

			.card {
				margin-top: 2rem !important;
			}

			.card-body {
				padding: 1.5rem !important;
			}
		}

		/* Эффект при фокусе на полях ввода */
		.form-control:focus {
			border-color: #86b7fe;
			box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, .25);
		}

		/* Стиль для ссылки условий */
		a[data-bs-target="#termsModal"] {
			color: #0d6efd;
			font-weight: 500;
		}

		a[data-bs-target="#termsModal"]:hover {
			text-decoration: underline;
		}
	</style>
{% endblock %}
